<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>
<style>
  body {
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(#70c5ce, #fff);
    user-select: none;
    -webkit-user-select: none;
  }

  .flappy-container {
    position: relative;
    width: 100%;
    height: 100vh; /* فول سكرين للموبايل */
    display: flex;
    justify-content: center;
    align-items: center;
  }

  canvas {
    display: block;
    width: 100%;
    max-width: 600px; /* على الكمبيوتر */
    height: 100%;
    max-height: 800px;
    border: 3px solid #000;
    background: #70c5ce;
  }

  #ui {
    position: absolute;
    width: 100%;
    top: 0;
    text-align: center;
    pointer-events: none;
  }

  #ui button {
    pointer-events: auto;
    margin: 10px;
    padding: 12px 25px;
    font-size: 18px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: #1e90ff;
    color: #fff;
  }

  #ui #scoreDisplay {
    font-size: 22px;
    color: #000;
    margin-top: 15px;
    pointer-events: none;
  }

  /* أزرار واضحة فقط على الموبايل */
  @media(min-width:601px){
    #ui button { display: none; }
  }
</style>
</head>
<body>
  <div class="flappy-container">
    <canvas id="gameCanvas"></canvas>
    <div id="ui">
      <div id="scoreDisplay">Score: 0</div>
      <button id="startBtn">Start</button>
      <button id="restartBtn" style="display:none;">Restart</button>
    </div>
  </div>

<script>
window.addEventListener("load", () => {
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const startBtn = document.getElementById("startBtn");
  const restartBtn = document.getElementById("restartBtn");
  const scoreDisplay = document.getElementById("scoreDisplay");

  // فول سكرين على الموبايل
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  let gameStarted = false;
  let gameOver = false;

  // الطائر
  const bird = { x: 80, y: canvas.height/2, width: 30, height: 30, velocity: 0, gravity: 0.6, jump: -10 };

  // الأنابيب
  const pipeWidth = 50, pipeGap = 150;
  const pipes = [];
  let pipeInterval = 90, frameCount = 0;

  let score = 0;

  // ----------------- التحكم -----------------
  const flap = () => {
    if(!gameStarted || gameOver) return;
    bird.velocity = bird.jump;
  };

  // المسطرة
  document.addEventListener("keydown", e => { if(e.code === "Space") flap(); });
  // الموبايل أو النقر بالماوس
  canvas.addEventListener("click", flap);
  canvas.addEventListener("touchstart", e => { flap(); e.preventDefault(); });

  startBtn.addEventListener("click", ()=>{
    gameStarted = true;
    startBtn.style.display = "none";
  });

  restartBtn.addEventListener("click", ()=>{
    resetGame();
    gameStarted = true;
    restartBtn.style.display = "none";
  });

  function resetGame() {
    bird.y = canvas.height/2;
    bird.velocity = 0;
    pipes.length = 0;
    score = 0;
    scoreDisplay.textContent = "Score: 0";
    gameOver = false;
    frameCount = 0;
  }

  function drawBird() {
    ctx.fillStyle = "yellow";
    ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
  }

  function drawPipes() {
    ctx.fillStyle = "green";
    for(let i=0;i<pipes.length;i++){
      let p = pipes[i];
      ctx.fillRect(p.x, 0, pipeWidth, p.top);
      ctx.fillRect(p.x, canvas.height - p.bottom, pipeWidth, p.bottom);
    }
  }

  function update() {
    if(!gameStarted || gameOver) return;

    frameCount++;
    bird.velocity += bird.gravity;
    bird.y += bird.velocity;

    if(frameCount % pipeInterval === 0) {
      let topHeight = Math.random() * (canvas.height - pipeGap - 100) + 50;
      let bottomHeight = canvas.height - pipeGap - topHeight;
      pipes.push({x: canvas.width, top: topHeight, bottom: bottomHeight});
    }

    for(let i=0;i<pipes.length;i++){
      pipes[i].x -= 3;
      if(pipes[i].x + pipeWidth === bird.x) {
        score++;
        scoreDisplay.textContent = "Score: " + score;
      }
    }

    while(pipes.length>0 && pipes[0].x + pipeWidth < 0) pipes.shift();

    for(let i=0;i<pipes.length;i++){
      let p = pipes[i];
      if(bird.x < p.x + pipeWidth && bird.x + bird.width > p.x && 
        (bird.y < p.top || bird.y + bird.height > canvas.height - p.bottom)) {
          gameOver = true;
          restartBtn.style.display = "inline-block";
      }
    }

    if(bird.y + bird.height > canvas.height || bird.y < 0){
      gameOver = true;
      restartBtn.style.display = "inline-block";
    }
  }

  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawBird();
    drawPipes();
    update();
    requestAnimationFrame(draw);
  }

  draw();
});
</script>
</body>
</html>
