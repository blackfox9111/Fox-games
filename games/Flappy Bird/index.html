<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>
<style>
  body {
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(#70c5ce, #fff);
    user-select: none; /* لمنع تحديد النص */
    -webkit-user-select: none;
  }
  canvas {
    background: #70c5ce;
    display: block;
    border: 3px solid #000;
  }
  #ui {
    position: absolute;
    top: 20px;
    text-align: center;
    width: 100%;
    font-family: Arial, sans-serif;
    color: #000;
    pointer-events: none; /* منع التفاعل مع النص */
  }
  button {
    pointer-events: auto;
    margin: 0 5px;
    padding: 8px 15px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #1e90ff;
    color: #fff;
  }
</style>
</head>
<body>
  <canvas id="gameCanvas" width="790" height="800"></canvas>
  <div id="ui">
    <div id="scoreDisplay">Score: 0</div>
    <button id="startBtn">Start</button>
    <button id="restartBtn" style="display:none;">Restart</button>
  </div>

<script>
window.addEventListener("load", () => {
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const startBtn = document.getElementById("startBtn");
  const restartBtn = document.getElementById("restartBtn");
  const scoreDisplay = document.getElementById("scoreDisplay");

  let gameStarted = false;
  let gameOver = false;

  // الطائر
  const bird = {
    x: 80,
    y: canvas.height/2,
    width: 30,
    height: 30,
    velocity: 0,
    gravity: 0.6,
    jump: -10
  };

  // الأنابيب
  const pipeWidth = 50;
  const pipeGap = 150;
  const pipes = [];
  let pipeInterval = 90; // عدد الإطارات بين توليد أنبوب جديد
  let frameCount = 0;

  let score = 0;

  // ----------------- التحكم -----------------
  const flap = () => {
    if(!gameStarted) return;
    bird.velocity = bird.jump;
  };

  document.addEventListener("keydown", (e) => {
    if(e.code === "Space") flap();
  });

  canvas.addEventListener("click", flap);
  canvas.addEventListener("touchstart", (e) => { flap(); e.preventDefault(); });

  startBtn.addEventListener("click", () => {
    gameStarted = true;
    startBtn.style.display = "none";
  });

  restartBtn.addEventListener("click", () => {
    resetGame();
    gameStarted = true;
    restartBtn.style.display = "none";
  });

  // ----------------- إعادة ضبط اللعبة -----------------
  function resetGame() {
    bird.y = canvas.height/2;
    bird.velocity = 0;
    pipes.length = 0;
    score = 0;
    scoreDisplay.textContent = "Score: 0";
    gameOver = false;
    frameCount = 0;
  }

  // ----------------- رسم الطائر -----------------
  function drawBird() {
    ctx.fillStyle = "yellow";
    ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
  }

  // ----------------- رسم الأنابيب -----------------
  function drawPipes() {
    ctx.fillStyle = "green";
    for(let i=0;i<pipes.length;i++){
      let p = pipes[i];
      // أنبوب علوي
      ctx.fillRect(p.x, 0, pipeWidth, p.top);
      // أنبوب سفلي
      ctx.fillRect(p.x, canvas.height - p.bottom, pipeWidth, p.bottom);
    }
  }

  // ----------------- التحديث -----------------
  function update() {
    if(!gameStarted || gameOver) return;

    frameCount++;
    bird.velocity += bird.gravity;
    bird.y += bird.velocity;

    // توليد أنابيب جديدة
    if(frameCount % pipeInterval === 0) {
      let topHeight = Math.random() * (canvas.height - pipeGap - 100) + 50;
      let bottomHeight = canvas.height - pipeGap - topHeight;
      pipes.push({x: canvas.width, top: topHeight, bottom: bottomHeight});
    }

    // تحريك الأنابيب واحتساب النقاط
    for(let i=0;i<pipes.length;i++){
      pipes[i].x -= 3;
      if(pipes[i].x + pipeWidth === bird.x) {
        score++;
        scoreDisplay.textContent = "Score: " + score;
      }
    }

    // إزالة الأنابيب اللي خرجت من الشاشة
    while(pipes.length > 0 && pipes[0].x + pipeWidth < 0) {
      pipes.shift();
    }

    // تصادمات
    for(let i=0;i<pipes.length;i++){
      let p = pipes[i];
      if(
        bird.x < p.x + pipeWidth &&
        bird.x + bird.width > p.x &&
        (bird.y < p.top || bird.y + bird.height > canvas.height - p.bottom)
      ){
        gameOver = true;
        restartBtn.style.display = "inline-block";
      }
    }

    // اصطدام مع الأرض أو السقف
    if(bird.y + bird.height > canvas.height || bird.y < 0){
      gameOver = true;
      restartBtn.style.display = "inline-block";
    }
  }

  // ----------------- رسم الإطار -----------------
  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawBird();
    drawPipes();

    update();

    requestAnimationFrame(draw);
  }

  draw();
});
</script>
</body>
</html>
